<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Unischooly – Trial Dashboard</title>

  <!-- SUPABASE CDN -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    body {
      margin: 0;
      background: radial-gradient(circle at top, #0b1a2d, #05080f);
      font-family: Inter, system-ui, sans-serif;
      color: #fff;
    }

    .container {
      max-width: 1100px;
      margin: 40px auto;
      padding: 0 20px;
    }

    .card {
      background: linear-gradient(180deg, #0e1b2e, #0a1220);
      border-radius: 18px;
      padding: 24px;
      box-shadow: 0 0 0 1px rgba(255,255,255,0.05);
      margin-bottom: 28px;
    }

    .pass-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #ffe08a;
      color: #000;
      padding: 10px 16px;
      border-radius: 12px;
      font-weight: 700;
      margin-bottom: 16px;
    }

    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
    }

    .label {
      opacity: 0.7;
      font-size: 13px;
    }

    .value {
      font-size: 15px;
      margin-top: 2px;
    }

    .center {
      text-align: center;
      margin-top: 18px;
      font-size: 13px;
      opacity: 0.6;
    }

    /* Section 2 */
    .schedule {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 16px;
      flex-wrap: wrap;
    }

    .timer {
      display: flex;
      gap: 10px;
    }

    .time-box {
      background: #141f33;
      padding: 10px 14px;
      border-radius: 10px;
      text-align: center;
      min-width: 60px;
    }

    .time-box strong {
      display: block;
      font-size: 18px;
    }

    .join-btn {
      background: linear-gradient(90deg,#ff6aa2,#ff9f68);
      border: none;
      padding: 14px 26px;
      border-radius: 30px;
      font-size: 15px;
      color: #000;
      cursor: pointer;
      font-weight: 600;
    }

    .disclaimer {
      font-size: 12px;
      opacity: 0.6;
      margin-top: 10px;
    }

    .link {
      color: #7ab7ff;
      cursor: pointer;
      font-size: 13px;
      margin-top: 8px;
      display: inline-block;
    }
  </style>
</head>

<body>

<div class="container">

  <!-- ================= SECTION 1 ================= -->
  <div class="card">
    <div class="pass-header">
      <span>OFFICIAL FREE TRIAL PASS</span>
      <span>[ VALUE: $30 – WAIVED ]</span>
    </div>

    <div class="grid">
      <div>
        <div class="label">Student Name</div>
        <div class="value" id="studentName">—</div>
      </div>
      <div>
        <div class="label">Grade</div>
        <div class="value" id="grade">—</div>
      </div>

      <div>
        <div class="label">Course</div>
        <div class="value" id="course">—</div>
      </div>
      <div>
        <div class="label">Parent Name</div>
        <div class="value" id="parentName">—</div>
      </div>

      <div>
        <div class="label">Parent Email</div>
        <div class="value" id="parentEmail">—</div>
      </div>
      <div>
        <div class="label">Parent Phone</div>
        <div class="value" id="parentPhone">—</div>
      </div>
    </div>

    <div class="center">Powered by <strong>Unischooly</strong></div>
  </div>

  <!-- ================= SECTION 2 ================= -->
  <div class="card">
    <h3>Class Schedule</h3>

    <div class="schedule">
      <div class="timer">
        <div class="time-box">
          <strong id="days">0</strong>Days
        </div>
        <div class="time-box">
          <strong id="hours">0</strong>Hours
        </div>
        <div class="time-box">
          <strong id="minutes">0</strong>Min
        </div>
        <div class="time-box">
          <strong id="seconds">0</strong>Sec
        </div>
      </div>

      <button class="join-btn">Join Class</button>
    </div>

    <div class="disclaimer">
      By clicking Join Class, you agree to Terms & Conditions.
    </div>

    <div class="link">Reschedule Class</div>
  </div>

</div>

<script>
/* ================= SUPABASE INIT ================= */
const SUPABASE_URL = "https://binklfyiypbhuzsvnlzg.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJpbmtsZnlpeXBiaHV6c3ZubHpnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUwMzA5NjgsImV4cCI6MjA4MDYwNjk2OH0.PYCRN7ubQA2XnVy8BYd6746iAGATjBuBAlvsCdLdbqw";

const supabase = window.supabase.createClient(
  SUPABASE_URL,
  SUPABASE_ANON_KEY
);

/* ================= FETCH DATA ================= */
const params = new URLSearchParams(window.location.search);
const bookingUUID = params.get("booking_uuid");

if (!bookingUUID) {
  alert("Booking UUID missing");
}

/* ================= MAIN ================= */
(async function init() {
  const { data, error } = await supabase
    .from("demo_leads")
    .select("*")
    .eq("booking_uuid", bookingUUID)
    .single();

  if (error || !data) {
    console.error(error);
    alert("Booking not found");
    return;
  }

  // Section 1
  document.getElementById("studentName").textContent = data.child_name;
  document.getElementById("grade").textContent = data.grade;
  document.getElementById("course").textContent = data.course;
  document.getElementById("parentName").textContent = data.parent_name;
  document.getElementById("parentEmail").textContent = data.parent_email;
  document.getElementById("parentPhone").textContent = data.parent_phone;

  // Section 2 – Countdown
  startCountdown(new Date(data.demo_start_time));
})();

/* ================= COUNTDOWN ================= */
function startCountdown(targetDate) {
  function tick() {
    const now = new Date();
    const diff = targetDate - now;

    if (diff <= 0) return;

    const d = Math.floor(diff / (1000 * 60 * 60 * 24));
    const h = Math.floor(diff / (1000 * 60 * 60)) % 24;
    const m = Math.floor(diff / (1000 * 60)) % 60;
    const s = Math.floor(diff / 1000) % 60;

    days.textContent = d;
    hours.textContent = h;
    minutes.textContent = m;
    seconds.textContent = s;
  }

  tick();
  setInterval(tick, 1000);
}
</script>

</body>
</html>
