<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Unischooly â€¢ Trial Dashboard</title>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg-dark: #060b14;
      --card-bg: #0d1833cc;
      --text: #eaf1ff;
      --muted: rgba(234,241,255,0.7);
      --gold: #f7d98a;
      --gold-glow: rgba(247, 217, 138, 0.2);
      --purple: #8b5cf6;
      --pink: #ff4fd8;
      --green: #10b981;
      --shadow: 0 20px 50px rgba(0,0,0,0.5);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0; font-family: 'Poppins', sans-serif;
      background: radial-gradient(circle at top, #1e1b4b 0%, #060b14 100%);
      color: var(--text); min-height: 100vh;
    }

    /* --- UTILS --- */
    .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }
    .hidden { display: none !important; }

    /* --- HEADER --- */
    header {
      background: rgba(6,11,20,0.9); backdrop-filter: blur(10px);
      position: sticky; top: 0; z-index: 50; padding: 15px 0; border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    .header-content { display: flex; justify-content: space-between; align-items: center; }
    .logo { height: 35px; }
    .status-pill {
      background: linear-gradient(90deg, #ff4fd8, #8b5cf6, #4cc9ff);
      padding: 8px 16px; border-radius: 50px; font-weight: 700; font-size: 0.85rem;
      display: flex; align-items: center; gap: 8px; box-shadow: 0 5px 15px rgba(139,92,246,0.3);
    }
    .check-icon { background: #fff; color: #8b5cf6; border-radius: 50%; width: 18px; height: 18px; display: flex; align-items: center; justify-content: center; font-size: 12px; }

    /* --- GRID --- */
    .grid-layout {
      display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-top: 40px; margin-bottom: 50px;
    }

    /* --- CARDS --- */
    .card {
      background: var(--card-bg); border: 1px solid rgba(255,255,255,0.1);
      border-radius: 20px; padding: 25px; box-shadow: var(--shadow); position: relative;
    }

    /* --- TICKET --- */
    .ticket-card {
      border: 2px solid var(--gold); box-shadow: 0 0 30px var(--gold-glow);
      background: linear-gradient(180deg, rgba(13,24,51,0.95), rgba(0,0,0,0.95));
    }
    .stamp {
      position: absolute; top: 15px; right: 15px;
      border: 3px double #ef4444; color: #ef4444; padding: 5px 10px;
      font-weight: 800; font-size: 0.8rem; transform: rotate(-12deg);
      border-radius: 4px; background: rgba(0,0,0,0.4); text-transform: uppercase;
    }
    .ticket-header {
      border-bottom: 2px dashed rgba(255,255,255,0.15); padding-bottom: 15px; margin-bottom: 20px;
    }
    .ticket-title { color: var(--gold); font-weight: 800; letter-spacing: 1px; text-transform: uppercase; font-size: 0.9rem; }
    
    .ticket-row { display: grid; grid-template-columns: 110px 1fr; margin-bottom: 12px; align-items: baseline; }
    .lbl { color: var(--muted); font-size: 0.75rem; text-transform: uppercase; font-weight: 600; letter-spacing: 0.5px; }
    .val { color: #fff; font-weight: 600; font-size: 0.95rem; }

    /* --- SCHEDULE --- */
    .schedule-info {
      background: rgba(255,255,255,0.05); border-radius: 12px; padding: 15px;
      display: flex; align-items: center; gap: 15px; margin-bottom: 20px;
    }
    .cal-icon { font-size: 1.5rem; }
    .reschedule-btn {
      width: 100%; background: #fff; color: #000; border: none; padding: 12px;
      border-radius: 50px; font-weight: 700; cursor: pointer; margin-top: 10px;
      font-size: 0.9rem; transition: transform 0.2s;
    }
    .reschedule-btn:hover { transform: translateY(-2px); }

    /* --- WELCOME & TIMER --- */
    .welcome-title { text-align: center; font-size: 1.4rem; font-weight: 700; margin-bottom: 5px; }
    .welcome-sub { text-align: center; color: var(--muted); font-size: 0.9rem; margin-bottom: 20px; }
    
    .timer-container {
      display: flex; justify-content: center; gap: 10px; margin-bottom: 25px;
    }
    .timer-box {
      background: #000; border: 1px solid rgba(255,255,255,0.2); border-radius: 8px;
      padding: 10px; min-width: 65px; text-align: center;
    }
    .t-val { font-size: 1.5rem; font-weight: 800; line-height: 1; display: block; }
    .t-lbl { font-size: 0.65rem; text-transform: uppercase; color: var(--muted); margin-top: 5px; }

    .join-btn {
      background: var(--green); color: #000; width: 100%; padding: 15px;
      border-radius: 50px; border: none; font-weight: 800; font-size: 1.1rem;
      cursor: pointer; box-shadow: 0 0 20px rgba(16, 185, 129, 0.4);
      display: block; max-width: 280px; margin: 0 auto 15px;
    }
    .join-btn:disabled { background: #333; color: #666; cursor: not-allowed; box-shadow: none; }
    
    .links-row { text-align: center; font-size: 0.8rem; color: var(--muted); }
    .text-link { color: var(--gold); text-decoration: underline; cursor: pointer; margin: 0 5px; }

    /* --- FACTS & GAMES --- */
    .fact-box {
      margin-top: 25px; background: rgba(255,255,255,0.03); padding: 15px; border-radius: 12px;
      border-left: 3px solid var(--purple);
    }
    .fact-text { min-height: 45px; font-size: 0.9rem; margin: 10px 0; line-height: 1.4; }
    .fact-nav button { background: rgba(255,255,255,0.1); border: none; color: white; width: 25px; height: 25px; border-radius: 50%; cursor: pointer; }

    .game-tabs { display: flex; background: rgba(255,255,255,0.1); border-radius: 50px; padding: 4px; margin-bottom: 15px; }
    .tab { flex: 1; text-align: center; padding: 8px; border-radius: 50px; font-size: 0.85rem; cursor: pointer; color: var(--muted); }
    .tab.active { background: var(--purple); color: #fff; font-weight: 700; }
    .game-panel { text-align: center; padding: 20px; background: rgba(0,0,0,0.2); border-radius: 12px; }

    /* --- OVERLAY / MODALS --- */
    .overlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.8); z-index: 1000;
      display: none; align-items: center; justify-content: center;
    }
    .overlay.open { display: flex; }
    .modal {
      background: #1e293b; padding: 25px; border-radius: 20px;
      width: 90%; max-width: 500px; position: relative;
      border: 1px solid rgba(255,255,255,0.1);
    }
    .close-modal { position: absolute; top: 15px; right: 15px; background: none; border: none; color: #fff; font-size: 1.5rem; cursor: pointer; }

    /* --- RESCHEDULE UI --- */
    .date-scroll { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 10px; margin-bottom: 15px; scrollbar-width: none; }
    .date-pill {
      min-width: 70px; height: 80px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
      border-radius: 12px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer;
    }
    .date-pill.selected { background: var(--gold); color: #000; border-color: var(--gold); }
    
    .time-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 15px; }
    .time-pill {
      padding: 10px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
      border-radius: 8px; text-align: center; cursor: pointer; font-size: 0.9rem;
    }
    .time-pill.selected { background: var(--gold); color: #000; font-weight: 700; border-color: var(--gold); }

    /* --- MOBILE --- */
    @media(max-width: 768px) {
      .grid-layout { grid-template-columns: 1fr; gap: 20px; }
      .header-content { flex-direction: row; }
      .status-pill span { display: none; }
      .status-pill:after { content: "Locked In!"; margin-left: 5px; }
      .ticket-card { padding: 20px; }
      .stamp { font-size: 0.7rem; top: 10px; right: 10px; }
    }
  </style>
</head>
<body>

  <header>
    <div class="container header-content">
      <img src="https://res.cloudinary.com/dpapyknn4/image/upload/v1763143023/Unischooly_Horizontal_logo_qbu1l7.svg" alt="Unischooly" class="logo">
      <div class="status-pill">
        <div class="check-icon">âœ“</div>
        <span>Your trial class is locked in!</span>
      </div>
    </div>
  </header>

  <div class="container grid-layout">
    
    <div class="left-col">
      <div class="card ticket-card">
        <div class="stamp">VALUE WAIVED</div>
        <div class="ticket-header">
          <div class="ticket-title">Official Entry Pass</div>
        </div>
        
        <div class="ticket-row"><div class="lbl">Student</div><div class="val" id="tk-child">Loading...</div></div>
        <div class="ticket-row"><div class="lbl">Grade</div><div class="val" id="tk-grade">--</div></div>
        <div class="ticket-row"><div class="lbl">Course</div><div class="val" id="tk-course">--</div></div>
        <div class="ticket-row"><div class="lbl">Parent</div><div class="val" id="tk-parent">--</div></div>
        <div class="ticket-row"><div class="lbl">Phone</div><div class="val" id="tk-phone">--</div></div>
        <div class="ticket-row"><div class="lbl">Email</div><div class="val" id="tk-email" style="font-size:0.85rem">--</div></div>
        
        <div style="text-align:center; font-size:0.75rem; color:rgba(255,255,255,0.4); margin-top:20px;">Powered by Unischooly</div>
      </div>

      <div class="card" style="margin-top: 25px;">
        <h3 style="margin-top:0; font-size:1.1rem;">ðŸš€ Ready for Blast Off!!!</h3>
        <div class="schedule-info">
          <div class="cal-icon">ðŸ“…</div>
          <div>
            <div style="font-weight:700; font-size:1.1rem;" id="sc-date">--</div>
            <div style="color:var(--muted); font-size:0.9rem;" id="sc-time">--</div>
          </div>
        </div>
        
        <button class="reschedule-btn" onclick="openReschedule()">ðŸ“… Reschedule Class</button>

        <div class="fact-box">
          <div style="color:var(--purple); font-weight:800; font-size:0.8rem;">DID YOU KNOW?</div>
          <div class="fact-text" id="fact-content">Loading...</div>
          <div class="fact-nav" style="display:flex; justify-content:flex-end; gap:5px;">
            <button onclick="changeFact(-1)">â€¹</button>
            <button onclick="changeFact(1)">â€º</button>
          </div>
        </div>
      </div>
    </div>

    <div class="right-col">
      <div class="card">
        <div class="welcome-title">Welcome to <span style="color:var(--pink)" id="w-name">Student</span>'s <br> Trial Class</div>
        <div class="welcome-sub">Class starts in:</div>

        <div class="timer-container" id="timer-ui">
          <div class="timer-box"><span class="t-val" id="d">00</span><span class="t-lbl">Days</span></div>
          <div class="timer-box"><span class="t-val" id="h">00</span><span class="t-lbl">Hrs</span></div>
          <div class="timer-box"><span class="t-val" id="m">00</span><span class="t-lbl">Mins</span></div>
          <div class="timer-box"><span class="t-val" id="s">00</span><span class="t-lbl">Secs</span></div>
        </div>
        <div id="class-ended" class="hidden" style="text-align:center; color:red; font-weight:700; margin-bottom:20px;">Class has Ended</div>

        <button class="join-btn" id="join-btn" disabled>Join Class</button>
        <div class="links-row">
          (Button activates 5 mins before)<br><br>
          <span class="text-link" onclick="openTerms()">Terms & Conditions</span>
        </div>
      </div>

      <div class="card" style="margin-top: 25px;">
        <div class="game-tabs">
          <div class="tab active" onclick="setGame('math', this)">Math</div>
          <div class="tab" onclick="setGame('memory', this)">Memory</div>
        </div>
        
        <div class="game-panel">
          <div id="game-math">
            <h2 id="math-q" style="margin:0 0 10px 0;">5 + 3 = ?</h2>
            <input type="number" id="math-in" style="padding:5px; border-radius:5px; border:none; text-align:center;">
            <button onclick="checkMath()" style="padding:5px 10px; border-radius:5px; border:none; cursor:pointer; background:var(--green);">Check</button>
            <div id="math-res" style="height:20px; margin-top:10px; font-weight:700; color:var(--green);"></div>
          </div>
          <div id="game-memory" class="hidden">
            <p>Memory Game</p>
            <div id="mem-grid" style="display:grid; grid-template-columns:repeat(4,1fr); gap:5px; max-width:200px; margin:0 auto;"></div>
            <button onclick="initMemory()" style="margin-top:10px; padding:5px 10px; cursor:pointer;">Reset</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="overlay" id="res-modal">
    <div class="modal">
      <button class="close-modal" onclick="closeReschedule()">Ã—</button>
      <h2 style="margin-top:0;">Reschedule Class</h2>
      
      <p style="font-size:0.85rem; color:var(--muted); margin-bottom:5px;">SELECT NEW DATE</p>
      <div class="date-scroll" id="date-container"></div>
      
      <p style="font-size:0.85rem; color:var(--muted); margin-bottom:5px;">SELECT NEW TIME</p>
      <div class="time-grid" id="time-container">
        <div class="time-pill" onclick="selTime(this, '16:00')">04:00 PM</div>
        <div class="time-pill" onclick="selTime(this, '17:00')">05:00 PM</div>
        <div class="time-pill" onclick="selTime(this, '18:00')">06:00 PM</div>
        <div class="time-pill" onclick="selTime(this, '19:00')">07:00 PM</div>
        <div class="time-pill" onclick="selTime(this, '20:00')">08:00 PM</div>
        <div class="time-pill" onclick="selTime(this, '21:00')">09:00 PM</div>
      </div>

      <p style="font-size:0.85rem; color:var(--muted); margin-bottom:5px;">TIMEZONE</p>
      <select id="res-tz" style="width:100%; padding:10px; background:#000; color:#fff; border:1px solid #333; border-radius:8px; margin-bottom:20px;">
        <option value="Asia/Kolkata">Asia/Kolkata (IST)</option>
        <option value="America/New_York">America/New_York (EST)</option>
        <option value="Europe/London">Europe/London (GMT)</option>
      </select>

      <button class="join-btn" style="width:100%; margin:0;" onclick="saveReschedule()">Confirm Change</button>
    </div>
  </div>

  <div class="overlay" id="terms-modal">
    <div class="modal">
      <button class="close-modal" onclick="closeTerms()">Ã—</button>
      <h2 style="margin-top:0;">Terms & Conditions</h2>
      <ul style="padding-left:20px; line-height:1.6; color:var(--muted);">
        <li>Classes are recorded for quality assurance.</li>
        <li>We maintain a zero-tolerance policy for bullying.</li>
        <li>Students should be dressed appropriately.</li>
        <li>Parents are welcome to observe but allow students to answer.</li>
      </ul>
    </div>
  </div>

  <script>
    // --- CONFIG ---
    const SUPABASE_URL = "https://binklfyiypbhuzsvnlzg.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJpbmtsZnlpeXBiaHV6c3ZubHpnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUwMzA5NjgsImV4cCI6MjA4MDYwNjk2OH0.PYCRN7ubQA2XnVy8BYd6746iAGATjBuBAlvsCdLdbqw";
    const sb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    // --- DATA ---
    const FACTS = {
      1: ["Coding is the new literacy.", "First computer bug was a moth.", "Python is named after Monty Python.", "There are 700+ coding languages."],
      2: ["Python is used by NASA.", "It's great for AI.", "Readable like English.", "Named after a comedy show."],
      default: ["Learning grows your brain.", "Mistakes help you learn.", "Practice makes perfect.", "Stay curious!"]
    };

    let lead = null;
    let classDate = null;
    let factIdx = 0;
    
    // --- INIT ---
    async function init() {
      const params = new URLSearchParams(window.location.search);
      const id = params.get('iduuid') || params.get('id');
      
      if(!id) { alert("No Booking ID found."); return; }

      const { data, error } = await sb.from('demo_leads').select('*').eq('id', id).single();
      
      if(error || !data) { console.error(error); alert("Could not load booking."); return; }
      
      lead = data;
      render();
      setupTimer();
      setupFacts();
      setupReschedule();
      newMath();
    }

    // --- RENDER ---
    function render() {
      const cMap = {1:"Coding", 2:"Python", 3:"Web Dev", 4:"GenAI", 5:"Roblox", 6:"Chess", 7:"Math"};
      const cName = cMap[lead.course_id] || "Coding";

      document.getElementById('tk-child').innerText = lead.child_name;
      document.getElementById('tk-grade').innerText = lead.child_grade || "--";
      document.getElementById('tk-course').innerText = cName;
      document.getElementById('tk-parent').innerText = lead.parent_name;
      document.getElementById('tk-phone').innerText = `+${lead.phone_country_code} ${lead.phone_number}`;
      document.getElementById('tk-email').innerText = lead.parent_email;

      document.getElementById('w-name').innerText = lead.child_name;
      document.getElementById('sc-date').innerText = lead.preferred_date || "Pending";
      document.getElementById('sc-time').innerText = (lead.preferred_time_slot || "--") + " (" + (lead.timezone || "") + ")";
      document.getElementById('res-tz').value = lead.timezone || "Asia/Kolkata";
    }

    // --- TIMER (ROBUST PARSING) ---
    function setupTimer() {
      if(!lead.preferred_date || !lead.preferred_time_slot) return;
      
      // Parse Time (Handle "3:00 PM" and "15:00:00")
      let timeStr = lead.preferred_time_slot;
      let hours = 0, mins = 0;

      if(timeStr.includes('M')) { // AM/PM format
         const parts = timeStr.match(/(\d+):(\d+)\s*(AM|PM)/i);
         if(parts) {
            hours = parseInt(parts[1]);
            mins = parseInt(parts[2]);
            if(parts[3].toUpperCase() === 'PM' && hours < 12) hours += 12;
            if(parts[3].toUpperCase() === 'AM' && hours === 12) hours = 0;
         }
      } else { // 24h format
         const parts = timeStr.split(':');
         hours = parseInt(parts[0]);
         mins = parseInt(parts[1]);
      }

      // Combine Date + Time
      const dateParts = lead.preferred_date.split('-'); // YYYY-MM-DD
      classDate = new Date(dateParts[0], dateParts[1]-1, dateParts[2], hours, mins, 0);

      const tick = () => {
        const now = new Date();
        const diff = classDate - now;

        if(diff <= 0) {
           if(Math.abs(diff) < 3600000) enableJoin(true); // Live for 1 hour
           else {
             document.getElementById('timer-ui').classList.add('hidden');
             document.getElementById('class-ended').classList.remove('hidden');
             document.getElementById('join-btn').innerText = "Class Ended";
           }
           return;
        }

        if(diff <= 300000) enableJoin(false); // Enable 5 mins before

        const d = Math.floor(diff / (1000*60*60*24));
        const h = Math.floor((diff % (1000*60*60*24)) / (1000*60*60));
        const m = Math.floor((diff % (1000*60*60)) / (1000*60));
        const s = Math.floor((diff % (1000*60)) / 1000);

        document.getElementById('d').innerText = d<10?'0'+d:d;
        document.getElementById('h').innerText = h<10?'0'+h:h;
        document.getElementById('m').innerText = m<10?'0'+m:m;
        document.getElementById('s').innerText = s<10?'0'+s:s;
      };
      
      setInterval(tick, 1000);
      tick();
    }

    function enableJoin(live) {
      const btn = document.getElementById('join-btn');
      if(btn.disabled) {
        btn.disabled = false;
        btn.innerText = live ? "JOIN CLASS (LIVE)" : "JOIN CLASS";
        btn.onclick = () => alert("Redirecting to Zoom...");
      }
    }

    // --- FUN FACTS ---
    function setupFacts() {
      const list = FACTS[lead.course_id] || FACTS.default;
      const el = document.getElementById('fact-content');
      const render = () => el.innerText = list[factIdx];
      
      window.changeFact = (dir) => {
        factIdx += dir;
        if(factIdx >= list.length) factIdx = 0;
        if(factIdx < 0) factIdx = list.length - 1;
        render();
      };
      render();
    }

    // --- GAMES ---
    window.setGame = (g, el) => {
      document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
      el.classList.add('active');
      document.getElementById('game-math').classList.add('hidden');
      document.getElementById('game-memory').classList.add('hidden');
      document.getElementById('game-'+g).classList.remove('hidden');
      if(g==='memory') initMemory();
    };

    let sum = 0;
    function newMath() {
      let a = Math.floor(Math.random()*10)+1;
      let b = Math.floor(Math.random()*10)+1;
      sum = a+b;
      document.getElementById('math-q').innerText = `${a} + ${b} = ?`;
      document.getElementById('math-in').value = '';
      document.getElementById('math-res').innerText = '';
    }
    window.checkMath = () => {
      if(parseInt(document.getElementById('math-in').value) === sum) {
        document.getElementById('math-res').innerText = "Correct! ðŸŽ‰";
        setTimeout(newMath, 1000);
      } else document.getElementById('math-res').innerText = "Try again";
    };

    function initMemory() {
       const grid = document.getElementById('mem-grid');
       grid.innerHTML = '';
       const chars = ['A','A','B','B','C','C','D','D'];
       chars.sort(()=>Math.random()-0.5);
       let sel = [], matched = 0;

       chars.forEach(c => {
         const d = document.createElement('div');
         d.style.cssText = "height:40px; background:#fff; border-radius:4px; cursor:pointer; display:flex; align-items:center; justify-content:center; color:#000; font-weight:bold;";
         d.dataset.val = c;
         d.onclick = () => {
            if(d.innerText || sel.length>=2) return;
            d.innerText = c;
            sel.push(d);
            if(sel.length===2) {
               if(sel[0].dataset.val === sel[1].dataset.val) {
                 sel=[]; matched++; if(matched===4) alert("You Win!");
               } else {
                 setTimeout(() => { sel.forEach(x=>x.innerText=''); sel=[]; }, 500);
               }
            }
         };
         grid.appendChild(d);
       });
    }

    // --- MODALS ---
    window.openTerms = () => document.getElementById('terms-modal').classList.add('open');
    window.closeTerms = () => document.getElementById('terms-modal').classList.remove('open');
    window.openReschedule = () => document.getElementById('res-modal').classList.add('open');
    window.closeReschedule = () => document.getElementById('res-modal').classList.remove('open');

    // --- RESCHEDULE LOGIC ---
    let selDate = null, selTime = null;
    function setupReschedule() {
       const con = document.getElementById('date-container');
       const days = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
       let h = '';
       for(let i=1; i<=14; i++) {
         const d = new Date(); d.setDate(d.getDate()+i);
         const iso = d.toISOString().split('T')[0];
         h += `<div class="date-pill" onclick="pickDate(this, '${iso}')">
                 <span style="font-size:0.7rem; text-transform:uppercase;">${days[d.getDay()]}</span>
                 <span style="font-size:1.2rem; font-weight:700;">${d.getDate()}</span>
               </div>`;
       }
       con.innerHTML = h;
    }
    window.pickDate = (el, val) => {
       document.querySelectorAll('.date-pill').forEach(x=>x.classList.remove('selected'));
       el.classList.add('selected');
       selDate = val;
    };
    window.selTime = (el, val) => {
       document.querySelectorAll('.time-pill').forEach(x=>x.classList.remove('selected'));
       el.classList.add('selected');
       selTime = val;
    };
    window.saveReschedule = async () => {
       if(!selDate || !selTime) { alert("Please select a date and time."); return; }
       
       const { error } = await sb.from('demo_leads').update({
          preferred_date: selDate,
          preferred_time_slot: selTime,
          timezone: document.getElementById('res-tz').value
       }).eq('id', lead.id);

       if(error) alert("Error saving.");
       else { alert("Class Rescheduled!"); location.reload(); }
    };

    // START
    init();
  </script>
</body>
</html>
