<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Unischooly ¬∑ Book Free Coding Trial Class</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/18.2.1/css/intlTelInput.css" />
  <style>
    :root {
      --bg: #050816;
      --bg-elevated: #080b1e;
      --bg-card: #0c1024;
      --border-subtle: #1d2240;
      --accent-start: #ff7ac7;
      --accent-mid: #a855f7;
      --accent-end: #22d3ee;
      --text-main: #f9fafb;
      --text-muted: #9ca3af;
      --text-soft: #6b7280;
      --error: #f97373;
      --success: #22c55e;
      --shadow-soft: 0 18px 45px rgba(0,0,0,0.75);
      --radius-xl: 24px;
      --radius-lg: 18px;
      --radius-pill: 999px;
      --transition-fast: 180ms ease-out;
      --transition-med: 240ms ease;
      --input-bg: #050816;
    }

    *,
    *::before,
    *::after {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Inter", sans-serif;
      background: radial-gradient(circle at top, #111827 0, #020617 48%, #000 100%);
      color: var(--text-main);
    }

    .page {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .gradient-border {
      position: relative;
      border-radius: var(--radius-xl);
      padding: 1px;
      background: linear-gradient(120deg, rgba(255,122,199,0.6), rgba(168,85,247,0.5), rgba(34,211,238,0.6));
    }

    .gradient-border-inner {
      border-radius: inherit;
      background: radial-gradient(circle at top left, #18181b 0, #020617 52%, #020617 100%);
      padding: 24px 28px;
    }

    header {
      position: sticky;
      top: 0;
      z-index: 40;
      backdrop-filter: blur(18px);
      background: linear-gradient(
        to bottom,
        rgba(3,7,18,0.95),
        rgba(3,7,18,0.9),
        transparent
      );
      border-bottom: 1px solid rgba(31,41,55,0.7);
    }

    .nav {
      max-width: 1180px;
      margin: 0 auto;
      padding: 14px 20px 10px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 20px;
    }

    .nav-left {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo-badge {
      width: 38px;
      height: 38px;
      border-radius: 14px;
      background: radial-gradient(circle at 20% 0, #f97316, #ec4899 35%, #6366f1 80%);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 18px rgba(248,113,113,0.45);
      color: #0b1020;
      font-weight: 800;
      font-size: 18px;
    }

    .brand-text-main {
      font-weight: 650;
      letter-spacing: 0.03em;
      font-size: 17px;
    }

    .brand-text-sub {
      font-size: 11px;
      color: var(--text-soft);
    }

    .nav-links {
      display: flex;
      align-items: center;
      gap: 18px;
      font-size: 13px;
      color: var(--text-muted);
    }

    .nav-link {
      position: relative;
      cursor: pointer;
      padding: 4px 0;
      transition: color var(--transition-fast);
    }

    .nav-link::after {
      content: "";
      position: absolute;
      left: 0;
      right: 0;
      bottom: -4px;
      height: 2px;
      border-radius: 999px;
      background: linear-gradient(to right, var(--accent-start), var(--accent-end));
      opacity: 0;
      transform: scaleX(0.5);
      transform-origin: center;
      transition: opacity var(--transition-fast), transform var(--transition-fast);
    }

    .nav-link:hover {
      color: #e5e7eb;
    }

    .nav-link:hover::after {
      opacity: 1;
      transform: scaleX(1);
    }

    .nav-cta {
      padding: 8px 18px;
      border-radius: 999px;
      border: none;
      background: linear-gradient(120deg, var(--accent-start), var(--accent-mid), var(--accent-end));
      color: #0b1020;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 10px 25px rgba(59,130,246,0.35);
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: transform var(--transition-fast), box-shadow var(--transition-fast);
    }

    .nav-cta:hover {
      transform: translateY(-1px);
      box-shadow: 0 16px 32px rgba(37,99,235,0.48);
    }

    .nav-cta span.icon {
      font-size: 14px;
    }

    main {
      flex: 1;
      display: flex;
      justify-content: center;
      padding: 14px 16px 40px;
    }

    .hero-layout {
      max-width: 1180px;
      width: 100%;
      display: grid;
      grid-template-columns: minmax(0, 1.2fr) minmax(0, 1.05fr);
      gap: 26px;
      align-items: flex-start;
    }

    .hero-left-badge-row {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(24,24,27,0.9);
      border: 1px solid rgba(55,65,81,0.7);
      font-size: 11px;
      color: var(--text-muted);
      margin-bottom: 10px;
    }

    .dot-live {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 10px rgba(34,197,94,0.7);
    }

    .hero-title {
      font-size: clamp(32px, 3.1vw, 38px);
      line-height: 1.1;
      margin: 4px 0 12px;
    }

    .hero-title span.highlight-main {
      background: linear-gradient(120deg, #f97316, #fb7185, #a855f7);
      -webkit-background-clip: text;
      color: transparent;
    }

    .hero-title span.highlight-sub {
      background: linear-gradient(120deg, #38bdf8, #22c55e);
      -webkit-background-clip: text;
      color: transparent;
    }

    .hero-subtitle {
      font-size: 14px;
      color: var(--text-muted);
      max-width: 540px;
      margin-bottom: 18px;
    }

    .hero-badges-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 12px;
    }

    .pill-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(75,85,99,0.85);
      background: radial-gradient(circle at top left, rgba(15,23,42,0.9), rgba(15,23,42,0.95));
      font-size: 11px;
      color: #e5e7eb;
    }

    .pill-badge span.icon {
      font-size: 13px;
    }

    .hero-card {
      margin-top: 10px;
    }

    .hero-card-title {
      font-size: 18px;
      font-weight: 650;
      margin-bottom: 10px;
    }

    .hero-card-title span.child {
      color: #f97316;
    }

    .hero-card-list {
      list-style: none;
      padding: 0;
      margin: 0;
      display: flex;
      flex-direction: column;
      gap: 6px;
      font-size: 13px;
      color: #e5e7eb;
    }

    .hero-card-list li {
      display: flex;
      align-items: flex-start;
      gap: 8px;
    }

    .hero-card-list span.check-icon {
      color: #22c55e;
      margin-top: 1px;
    }

    .hero-stats-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 14px;
      font-size: 11px;
      color: var(--text-muted);
    }

    .hero-stat-chip {
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(55,65,81,0.9);
      background: rgba(15,23,42,0.95);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .hero-stat-chip span.value {
      color: #e5e7eb;
      font-weight: 600;
    }

    .hero-form-card-wrapper {
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow-soft);
      background: radial-gradient(circle at top left, #111827 0, #020617 55%);
      border: 1px solid rgba(75,85,99,0.8);
      overflow: hidden;
    }

    .hero-form-card {
      padding: 22px 22px 24px;
    }

    .alert-banner {
      display: none;
      border-radius: 999px;
      padding: 8px 14px;
      margin-bottom: 14px;
      font-size: 11px;
      background: rgba(239,68,68,0.1);
      border: 1px solid rgba(248,113,113,0.7);
      color: #fecaca;
      display: none;
    }

    .alert-banner.show {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .alert-banner span.icon {
      font-size: 13px;
    }

    .form-header-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 14px;
    }

    .form-title-block h2 {
      font-size: 15px;
      margin: 0 0 4px;
    }

    .form-title-block p {
      margin: 0;
      font-size: 11px;
      color: var(--text-soft);
    }

    .step-meta {
      text-align: right;
      font-size: 11px;
      color: var(--text-soft);
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 6px;
    }

    .step-indicator {
      display: flex;
      gap: 6px;
      width: 120px;
    }

    .step-bar {
      flex: 1;
      height: 4px;
      border-radius: 999px;
      background: #020617;
      border: 1px solid rgba(31,41,55,0.85);
      overflow: hidden;
    }

    .step-bar-inner {
      width: 0;
      height: 100%;
      border-radius: inherit;
      background: linear-gradient(120deg, var(--accent-start), var(--accent-mid), var(--accent-end));
      box-shadow: 0 0 18px rgba(59,130,246,0.85);
      transition: width var(--transition-med);
    }

    .step-bar-inner.active {
      width: 100%;
    }

    .form-section-title {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 6px;
    }

    .form-section-subtitle {
      font-size: 11px;
      color: var(--text-soft);
      margin-bottom: 12px;
    }

    .form-grid-2 {
      display: grid;
      grid-template-columns: minmax(0, 1fr) minmax(0, 1fr);
      gap: 10px;
    }

    .field-group {
      margin-bottom: 10px;
    }

    .field-row-inline {
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1.2fr);
      gap: 8px;
    }

    label.field-label {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 11px;
      margin-bottom: 4px;
      color: var(--text-muted);
    }

    label.field-label span.right-hint {
      font-size: 10px;
      color: var(--text-soft);
    }

    .helper-text {
      font-size: 10px;
      color: var(--text-soft);
      margin-top: 4px;
    }

    input[type="text"],
    input[type="email"],
    select,
    .fake-input {
      width: 100%;
      padding: 9px 11px;
      border-radius: 999px;
      border: 1px solid rgba(55,65,81,0.95);
      background: radial-gradient(circle at top left, #020617 0, #020617 60%);
      color: #e5e7eb;
      font-size: 12px;
      outline: none;
      transition: border-color var(--transition-fast), box-shadow var(--transition-fast),
        background var(--transition-fast), transform var(--transition-fast);
    }

    input:focus,
    select:focus {
      border-color: rgba(129,140,248,0.95);
      box-shadow: 0 0 0 1px rgba(129,140,248,0.7);
      transform: translateY(-0.5px);
      background: radial-gradient(circle at top left,#020617 0,#020617 70%);
    }

    .intl-tel-input {
      width: 100%;
    }

    .intl-tel-input .selected-flag {
      border-radius: 999px 0 0 999px;
      background: #020617;
    }

    .intl-tel-input .iti__selected-flag {
      padding-left: 10px;
    }

    .intl-tel-input input[type="tel"] {
      width: 100%;
      border-radius: 999px;
      border: 1px solid rgba(55,65,81,0.95);
      background: radial-gradient(circle at top left, #020617 0, #020617 60%);
      color: #e5e7eb;
      font-size: 12px;
      padding: 9px 11px 9px 96px;
    }

    .toggle-pill-group {
      display: inline-flex;
      padding: 3px;
      border-radius: 999px;
      background: rgba(15,23,42,0.9);
      border: 1px solid rgba(55,65,81,0.9);
      gap: 3px;
    }

    .toggle-pill {
      border-radius: 999px;
      border: none;
      background: transparent;
      color: var(--text-muted);
      font-size: 11px;
      padding: 6px 16px;
      cursor: pointer;
      transition: background var(--transition-fast), color var(--transition-fast),
        box-shadow var(--transition-fast), transform var(--transition-fast);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .toggle-pill span.icon {
      font-size: 12px;
    }

    .toggle-pill.active {
      background: linear-gradient(120deg, var(--accent-start), var(--accent-mid), var(--accent-end));
      color: #020617;
      box-shadow: 0 10px 28px rgba(59,130,246,0.65);
      transform: translateY(-0.5px);
    }

    .primary-cta {
      width: 100%;
      border-radius: 999px;
      border: none;
      margin-top: 10px;
      padding: 11px 14px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      background: linear-gradient(120deg, var(--accent-start), var(--accent-mid), var(--accent-end));
      color: #020617;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      box-shadow: 0 18px 45px rgba(59,130,246,0.65);
      transition: transform var(--transition-fast), box-shadow var(--transition-fast), filter var(--transition-fast);
    }

    .primary-cta span.icon {
      font-size: 16px;
    }

    .primary-cta:hover {
      transform: translateY(-1px);
      filter: brightness(1.05);
      box-shadow: 0 20px 50px rgba(37,99,235,0.85);
    }

    .primary-cta:disabled {
      opacity: 0.6;
      cursor: default;
      box-shadow: none;
      transform: none;
    }

    .cta-footnote {
      font-size: 10px;
      color: var(--text-soft);
      margin-top: 5px;
      text-align: center;
    }

    .back-link {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
      color: var(--text-muted);
      cursor: pointer;
      margin-bottom: 10px;
      transition: color var(--transition-fast), transform var(--transition-fast);
    }

    .back-link span.icon {
      font-size: 13px;
    }

    .back-link:hover {
      color: #e5e7eb;
      transform: translateX(-2px);
    }

    .date-grid,
    .time-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 8px;
      margin-bottom: 14px;
    }

    .date-chip,
    .time-chip {
      border-radius: 16px;
      padding: 10px 10px 9px;
      background: rgba(15,23,42,0.95);
      border: 1px solid rgba(55,65,81,0.8);
      cursor: pointer;
      display: flex;
      flex-direction: column;
      justify-content: center;
      gap: 2px;
      transition: border-color var(--transition-fast), box-shadow var(--transition-fast),
        transform var(--transition-fast), background var(--transition-fast);
      font-size: 11px;
      color: #e5e7eb;
      min-height: 54px;
    }

    .date-chip span.day-label {
      font-size: 11px;
      color: var(--text-muted);
    }

    .date-chip span.date-label {
      font-size: 13px;
      font-weight: 600;
    }

    .date-chip.active,
    .time-chip.active {
      border-color: rgba(129,140,248,0.95);
      box-shadow: 0 0 0 1px rgba(129,140,248,0.8);
      background: radial-gradient(circle at top left,#020617 0,#020617 70%);
      transform: translateY(-1px);
    }

    .time-chip-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 4px;
    }

    .time-main-label {
      font-size: 13px;
      font-weight: 600;
    }

    .star-tag {
      font-size: 9px;
      padding: 2px 6px;
      border-radius: 999px;
      background: rgba(251,191,36,0.12);
      border: 1px solid rgba(251,191,36,0.7);
      color: #fde68a;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      white-space: nowrap;
    }

    .star-tag span.icon {
      font-size: 11px;
    }

    .slot-subtext {
      font-size: 10px;
      color: var(--text-soft);
    }

    .language-pills {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 10px;
      margin-top: 4px;
    }

    .language-pill {
      border-radius: 999px;
      padding: 5px 12px;
      font-size: 11px;
      border: 1px solid rgba(55,65,81,0.9);
      background: rgba(15,23,42,0.95);
      color: var(--text-muted);
      cursor: pointer;
      transition: background var(--transition-fast), color var(--transition-fast),
        box-shadow var(--transition-fast), transform var(--transition-fast);
    }

    .language-pill.active {
      background: linear-gradient(120deg,var(--accent-start),var(--accent-mid),var(--accent-end));
      color: #020617;
      box-shadow: 0 10px 25px rgba(37,99,235,0.7);
      transform: translateY(-1px);
    }

    .legal-note {
      font-size: 10px;
      color: var(--text-soft);
      margin-top: 5px;
      text-align: center;
      line-height: 1.4;
    }

    .chip-group {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 12px;
      margin-top: 4px;
    }

    .choice-chip {
      border-radius: 999px;
      padding: 6px 13px;
      font-size: 11px;
      border: 1px solid rgba(55,65,81,0.85);
      background: rgba(15,23,42,0.9);
      color: var(--text-muted);
      cursor: pointer;
      transition: background var(--transition-fast), color var(--transition-fast),
        box-shadow var(--transition-fast), transform var(--transition-fast);
    }

    .choice-chip.active {
      background: linear-gradient(120deg,var(--accent-start),var(--accent-mid),var(--accent-end));
      color: #020617;
      box-shadow: 0 12px 30px rgba(37,99,235,0.75);
      transform: translateY(-1px);
    }

    .step-caption {
      font-size: 11px;
      color: var(--text-soft);
      margin-bottom: 6px;
    }

    .centered-message {
      font-size: 11px;
      color: var(--text-soft);
      padding: 10px 0;
    }

    .success-message {
      font-size: 12px;
      color: #bbf7d0;
      background: rgba(22,163,74,0.12);
      border-radius: 16px;
      padding: 10px 12px;
      border: 1px solid rgba(34,197,94,0.6);
      margin-top: 10px;
    }

    .error-text-inline {
      font-size: 10px;
      color: #fecaca;
      margin-top: 4px;
    }

    @media (max-width: 991px) {
      .hero-layout {
        grid-template-columns: minmax(0, 1fr);
      }
      .hero-form-card-wrapper {
        order: -1;
      }
    }

    @media (max-width: 640px) {
      .nav {
        padding-inline: 12px;
      }
      main {
        padding: 10px 10px 32px;
      }
      .hero-form-card {
        padding-inline: 16px;
      }
      .gradient-border-inner {
        padding-inline: 18px;
      }
      .hero-title {
        font-size: 26px;
      }
      .form-header-row {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }
      .step-meta {
        align-items: flex-start;
      }
      .field-row-inline {
        grid-template-columns: minmax(0,1.25fr) minmax(0,1.5fr);
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <div class="nav">
        <div class="nav-left">
          <div class="logo-badge">U</div>
          <div>
            <div class="brand-text-main">Unischooly</div>
            <div class="brand-text-sub">Future‚Äëready skills for kids</div>
          </div>
        </div>
        <div class="nav-links">
          <div class="nav-link">Programs</div>
          <div class="nav-link">How it works</div>
          <div class="nav-link">Parent reviews</div>
          <button class="nav-cta" type="button" onclick="scrollToForm()">
            <span class="icon">‚ö°</span>
            <span>Book Free Trial</span>
          </button>
        </div>
      </div>
    </header>

    <main>
      <div class="hero-layout">
        <!-- LEFT: Hero copy -->
        <section>
          <div class="hero-left-badge-row">
            <div class="dot-live"></div>
            <span>LIVE 1:1 Free Trial</span>
            <span>¬∑</span>
            <span>Limited daily slots</span>
          </div>
          <h1 class="hero-title">
            <span class="highlight-main">Book Now</span>
            &nbsp;&amp;&nbsp;
            <span class="highlight-sub">Get Certified</span>
          </h1>
          <p class="hero-subtitle">
            Share your details, pick a slot in your child‚Äôs local time, and we‚Äôll match
            you with a certified Unischooly teacher for a personalised 1:1 coding trial class.
          </p>

          <div class="hero-badges-row">
            <div class="pill-badge">
              <span class="icon">üåé</span>
              <span>Kids in 30+ countries</span>
            </div>
            <div class="pill-badge">
              <span class="icon">üíª</span>
              <span>Live 1:1 project class</span>
            </div>
            <div class="pill-badge">
              <span class="icon">üèÖ</span>
              <span>Certificate after demo</span>
            </div>
          </div>

          <div class="hero-card gradient-border hero-card">
            <div class="gradient-border-inner">
              <div class="hero-card-title">
                Free Live Coding Class for <span class="child">Your Child</span>
              </div>
              <ul class="hero-card-list">
                <li>
                  <span class="check-icon">‚úÖ</span>
                  <span>Personalised 45‚Äëminute 1:1 session aligned to your child‚Äôs grade &amp; interest.</span>
                </li>
                <li>
                  <span class="check-icon">‚úÖ</span>
                  <span>Hands‚Äëon live project inside the class ‚Äî no boring slides.</span>
                </li>
                <li>
                  <span class="check-icon">‚úÖ</span>
                  <span>Detailed class report &amp; digital certificate shared on WhatsApp &amp; email.</span>
                </li>
              </ul>
              <div class="hero-stats-row">
                <div class="hero-stat-chip">
                  <span class="value">25,000+</span>
                  <span>kids taught</span>
                </div>
                <div class="hero-stat-chip">
                  <span class="value">45 mins</span>
                  <span>live class</span>
                </div>
                <div class="hero-stat-chip">
                  <span class="value">4.8‚òÖ</span>
                  <span>avg parent rating</span>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- RIGHT: 3‚Äëstep booking form -->
        <section id="booking-form-card" class="hero-form-card-wrapper">
          <div class="hero-form-card" id="form-top">
            <div id="alert-banner" class="alert-banner">
              <span class="icon">‚ö†Ô∏è</span>
              <span id="alert-text">Unable to save your details. Please try again in a moment.</span>
            </div>

            <div class="form-header-row">
              <div class="form-title-block">
                <h2>Free Live Coding Class for Your Child</h2>
                <p>Three quick steps to unlock a personalised free trial class.</p>
              </div>
              <div class="step-meta">
                <span id="step-label">STEP 1 OF 3</span>
                <div class="step-indicator">
                  <div class="step-bar"><div id="step-bar-1" class="step-bar-inner active"></div></div>
                  <div class="step-bar"><div id="step-bar-2" class="step-bar-inner"></div></div>
                  <div class="step-bar"><div id="step-bar-3" class="step-bar-inner"></div></div>
                </div>
              </div>
            </div>

            <!-- STEP 1 -->
            <div id="step-1">
              <div class="form-section-title">Book Now &amp; Get Certified</div>
              <div class="form-section-subtitle">
                Share your details to unlock a personalised free trial class.
              </div>

              <form id="step-1-form">
                <div class="field-group">
                  <label class="field-label" for="phone-input">
                    <span>WhatsApp Number</span>
                    <span class="right-hint">We‚Äôll send class link &amp; updates here</span>
                  </label>
                  <div class="field-row-inline">
                    <input id="phone-input" type="tel" placeholder="Enter WhatsApp number" />
                  </div>
                  <div class="helper-text">
                    Please share the number that you use for WhatsApp.
                  </div>
                  <div id="phone-error" class="error-text-inline" style="display:none;"></div>
                </div>

                <div class="form-grid-2">
                  <div class="field-group">
                    <label class="field-label" for="child-name">Child‚Äôs Name</label>
                    <input id="child-name" type="text" placeholder="E.g. Aarav, Emma" autocomplete="off" />
                  </div>
                  <div class="field-group">
                    <label class="field-label" for="child-grade">Select Child‚Äôs Grade</label>
                    <select id="child-grade">
                      <option value="">Select grade</option>
                    </select>
                  </div>
                </div>

                <div class="form-grid-2">
                  <div class="field-group">
                    <label class="field-label" for="parent-name">Parent‚Äôs / Guardian Name</label>
                    <input id="parent-name" type="text" placeholder="Parent / Guardian full name" autocomplete="off" />
                  </div>
                  <div class="field-group">
                    <label class="field-label" for="parent-email">Parent‚Äôs Email</label>
                    <input id="parent-email" type="email" placeholder="We will send confirmation here" autocomplete="off" />
                  </div>
                </div>

                <div class="field-group">
                  <label class="field-label">Do you have a Laptop / Desktop?</label>
                  <div class="toggle-pill-group" id="laptop-toggle">
                    <button type="button" class="toggle-pill active" data-value="Yes">
                      <span class="icon">üíª</span><span>Yes</span>
                    </button>
                    <button type="button" class="toggle-pill" data-value="No">
                      <span class="icon">üì±</span><span>No (Tablet / Mobile only)</span>
                    </button>
                  </div>
                </div>

                <button id="step-1-submit" type="submit" class="primary-cta">
                  <span class="icon">üöÄ</span>
                  <span>Book a Free Trial Class</span>
                </button>
                <div class="cta-footnote">
                  Note: We will share the class link &amp; certificate on Email &amp; WhatsApp.
                </div>
              </form>
            </div>

            <!-- STEP 2 -->
            <div id="step-2" style="display:none;">
              <div class="back-link" onclick="goToStep(1)">
                <span class="icon">‚Üê</span>
                <span>Back to details</span>
              </div>

              <div class="form-section-title">Select Date &amp; Time</div>
              <div class="form-section-subtitle">
                Choose a slot that works in your child‚Äôs local time. Your class will be for 1 hour.
              </div>

              <div class="field-group">
                <div class="field-label">
                  <span>Select Date</span>
                  <span class="right-hint" id="date-range-label"></span>
                </div>
                <div class="form-section-subtitle" style="margin-bottom:8px;">
                  Your class will be for 1 hour.
                </div>
                <div id="date-grid" class="date-grid"></div>
              </div>

              <div class="field-group">
                <div class="field-label">
                  <span>Select Start Time</span>
                </div>
                <div class="form-section-subtitle" style="margin-bottom:8px;">
                  Class slots are limited. Times are shown in your local time zone.
                </div>
                <div id="time-grid" class="time-grid"></div>
              </div>

              <div class="field-group">
                <label class="field-label">
                  <span>Select Language</span>
                </label>
                <div class="language-pills" id="language-pills">
                  <!-- JS will fill pills -->
                </div>
              </div>

              <button id="step-2-submit" type="button" class="primary-cta">
                <span class="icon">‚ú®</span>
                <span>Confirm Class Time</span>
              </button>
              <div class="cta-footnote">
                Note: Free class will be conducted by reputed teachers.
              </div>
              <div class="legal-note">
                By continuing I agree to be contacted by Unischooly via WhatsApp / Phone / Email for this booking.
              </div>
              <div id="step-2-error" class="error-text-inline" style="text-align:center; display:none;"></div>
            </div>

            <!-- STEP 3 -->
            <div id="step-3" style="display:none;">
              <div class="back-link" onclick="goToStep(2)">
                <span class="icon">‚Üê</span>
                <span>Back to time selection</span>
              </div>

              <div class="form-section-title">Help us personalise your experience</div>
              <div class="form-section-subtitle">
                Answer a few quick questions so we can match the right mentor &amp; course plan.
              </div>

              <div class="field-group">
                <div class="field-label">
                  <span>Who are you?</span>
                </div>
                <div class="chip-group" id="chip-who">
                  <button type="button" class="choice-chip" data-value="Parent">Parent</button>
                  <button type="button" class="choice-chip" data-value="Student">Student</button>
                  <button type="button" class="choice-chip" data-value="Guardian">Guardian</button>
                </div>
              </div>

              <div class="field-group">
                <div class="field-label">
                  <span>Why are you booking this trial class?</span>
                </div>
                <div class="chip-group" id="chip-why">
                  <button type="button" class="choice-chip" data-value="Want to buy course">Want to buy course</button>
                  <button type="button" class="choice-chip" data-value="To compare platform">To compare platform</button>
                  <button type="button" class="choice-chip" data-value="To strengthen concepts">To strengthen concepts</button>
                  <button type="button" class="choice-chip" data-value="Just for free demo">Just for free demo</button>
                </div>
              </div>

              <div class="field-group">
                <div class="field-label">
                  <span>When are you planning to purchase?</span>
                </div>
                <div class="chip-group" id="chip-when">
                  <button type="button" class="choice-chip" data-value="After the demo">After the demo</button>
                  <button type="button" class="choice-chip" data-value="This week">This week</button>
                  <button type="button" class="choice-chip" data-value="This month">This month</button>
                  <button type="button" class="choice-chip" data-value="Just exploring">Just exploring</button>
                </div>
              </div>

              <button id="step-3-submit" type="button" class="primary-cta">
                <span class="icon">‚úÖ</span>
                <span>Submit</span>
              </button>
              <div id="step-3-success" class="success-message" style="display:none;">
                Thank you! Your free trial class has been booked. Our team will share the class link,
                project brief &amp; certificate details on WhatsApp and email.
              </div>
            </div>
          </div>
        </section>
      </div>
    </main>
  </div>

  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/18.2.1/js/intlTelInput.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/18.2.1/js/utils.js"></script>
  <script>
    const SUPABASE_URL = "https://binklfyiypbhuzsvnlzg.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJpbmtsZnlpeXBiaHV6c3ZubHpnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUwMzA5NjgsImV4cCI6MjA4MDYwNjk2OH0.PYCRN7ubQA2XnVy8BYd6746iAGATjBuBAlvsCdLdbqw";

    // ISO2 -> Region mapping injected from your spreadsheet
    const ISO2_TO_REGION = {
  "AW": "ROW",
  "AF": "ROW",
  "AO": "ROW",
  "AI": "ROW",
  "AX": "ROW",
  "AL": "ROW",
  "AD": "ROW",
  "AE": "MEA",
  "AR": "ROW",
  "AM": "ROW",
  "AS": "ROW",
  "AQ": "ROW",
  "TF": "ROW",
  "AG": "ROW",
  "AU": "ANZ",
  "AT": "ROW",
  "AZ": "ROW",
  "BI": "ROW",
  "BE": "ROW",
  "BJ": "ROW",
  "BQ": "ROW",
  "BF": "ROW",
  "BD": "ASIA",
  "BG": "ROW",
  "BH": "MEA",
  "BS": "ROW",
  "BA": "ROW",
  "BL": "ROW",
  "BY": "ROW",
  "BZ": "ROW",
  "BM": "ROW",
  "BO": "ROW",
  "BR": "ROW",
  "BB": "ROW",
  "BN": "ROW",
  "BT": "ASIA",
  "BV": "ROW",
  "BW": "ROW",
  "CF": "ROW",
  "CA": "USA",
  "CC": "ROW",
  "CH": "ROW",
  "CL": "ROW",
  "CN": "ASIA",
  "CI": "ROW",
  "CM": "ROW",
  "CD": "ROW",
  "CG": "ROW",
  "CK": "ROW",
  "CO": "ROW",
  "KM": "ROW",
  "CV": "ROW",
  "CR": "ROW",
  "CU": "ROW",
  "CW": "ROW",
  "CX": "ROW",
  "KY": "ROW",
  "CY": "ROW",
  "CZ": "ROW",
  "DE": "ROW",
  "DJ": "ROW",
  "DM": "ROW",
  "DK": "ROW",
  "DO": "ROW",
  "DZ": "ROW",
  "EC": "ROW",
  "EG": "MEA",
  "ER": "ROW",
  "EH": "ROW",
  "ES": "ROW",
  "EE": "ROW",
  "ET": "ROW",
  "FI": "ROW",
  "FJ": "ROW",
  "FK": "ROW",
  "FR": "ROW",
  "FO": "ROW",
  "FM": "ROW",
  "GA": "ROW",
  "GB": "ROW",
  "GE": "ROW",
  "GG": "ROW",
  "GH": "ROW",
  "GI": "ROW",
  "GN": "ROW",
  "GP": "ROW",
  "GM": "ROW",
  "GW": "ROW",
  "GQ": "ROW",
  "GR": "ROW",
  "GD": "ROW",
  "GL": "ROW",
  "GT": "ROW",
  "GF": "ROW",
  "GU": "ROW",
  "GY": "ROW",
  "HK": "ROW",
  "HM": "ROW",
  "HN": "ROW",
  "HR": "ROW",
  "HT": "ROW",
  "HU": "ROW",
  "ID": "SEA",
  "IM": "ROW",
  "IN": "ASIA",
  "IO": "ROW",
  "IE": "ROW",
  "IR": "ROW",
  "IQ": "MEA",
  "IS": "ROW",
  "IL": "ROW",
  "IT": "ROW",
  "JM": "ROW",
  "JE": "ROW",
  "JO": "MEA",
  "JP": "ASIA",
  "KZ": "ROW",
  "KE": "ROW",
  "KG": "ROW",
  "KH": "SEA",
  "KI": "ROW",
  "KN": "ROW",
  "KR": "ROW",
  "KW": "MEA",
  "LA": "ROW",
  "LB": "MEA",
  "LR": "ROW",
  "LY": "ROW",
  "LC": "ROW",
  "LI": "ROW",
  "LK": "ASIA",
  "LS": "ROW",
  "LT": "ROW",
  "LU": "ROW",
  "LV": "ROW",
  "MO": "ROW",
  "MF": "ROW",
  "MA": "ROW",
  "MC": "ROW",
  "MD": "ROW",
  "MG": "ROW",
  "MV": "ASIA",
  "MX": "ROW",
  "MH": "ROW",
  "MK": "ROW",
  "ML": "ROW",
  "MT": "ROW",
  "MM": "SEA",
  "ME": "ROW",
  "MN": "ASIA",
  "MP": "ROW",
  "MZ": "ROW",
  "MR": "ROW",
  "MS": "ROW",
  "MQ": "ROW",
  "MU": "ROW",
  "MW": "ROW",
  "MY": "SEA",
  "YT": "ROW",
  "NA": "ROW",
  "NC": "ROW",
  "NE": "ROW",
  "NF": "ROW",
  "NG": "ROW",
  "NI": "ROW",
  "NU": "ROW",
  "NL": "ROW",
  "NO": "ROW",
  "NP": "ASIA",
  "NR": "ROW",
  "NZ": "ANZ",
  "OM": "MEA",
  "PK": "ASIA",
  "PA": "ROW",
  "PN": "ROW",
  "PE": "ROW",
  "PH": "SEA",
  "PW": "ROW",
  "PG": "ROW",
  "PL": "ROW",
  "PR": "ROW",
  "KP": "ROW",
  "PT": "ROW",
  "PY": "ROW",
  "PS": "ROW",
  "PF": "ROW",
  "QA": "MEA",
  "RE": "ROW",
  "RO": "ROW",
  "RU": "ROW",
  "RW": "ROW",
  "SA": "MEA",
  "SD": "ROW",
  "SN": "ROW",
  "SG": "SEA",
  "GS": "ROW",
  "SH": "ROW",
  "SJ": "ROW",
  "SB": "ROW",
  "SL": "ROW",
  "SV": "ROW",
  "SM": "ROW",
  "SO": "ROW",
  "PM": "ROW",
  "RS": "ROW",
  "SS": "ROW",
  "ST": "ROW",
  "SR": "ROW",
  "SK": "ROW",
  "SI": "ROW",
  "SE": "ROW",
  "SZ": "ROW",
  "SX": "ROW",
  "SC": "ROW",
  "SY": "ROW",
  "TC": "ROW",
  "TD": "ROW",
  "TG": "ROW",
  "TH": "SEA",
  "TJ": "ROW",
  "TK": "ROW",
  "TM": "ROW",
  "TL": "ROW",
  "TO": "ROW",
  "TT": "ROW",
  "TN": "ROW",
  "TR": "ROW",
  "TV": "ROW",
  "TW": "ROW",
  "TZ": "ROW",
  "UG": "ROW",
  "UA": "ROW",
  "UM": "ROW",
  "UY": "ROW",
  "US": "USA",
  "UZ": "ROW",
  "VA": "ROW",
  "VC": "ROW",
  "VE": "ROW",
  "VG": "ROW",
  "VI": "ROW",
  "VN": "SEA",
  "VU": "ROW",
  "WF": "ROW",
  "WS": "ROW",
  "YE": "ROW",
  "ZA": "ROW",
  "ZM": "ROW",
  "ZW": "ROW"
};

    const LANGUAGES = ["english", "arabic", "bahasa", "vietnamese", "filipino", "thai"];

    const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    let itiInstance = null;
    let currentStep = 1;
    let currentLeadId = null;
    let currentRegionKey = null;
    let currentCourseId = null;
    let landingLang = null;
    let selectedSlot = null;
    let selectedLanguage = null;

    function scrollToForm() {
      const el = document.getElementById("form-top");
      if (el) el.scrollIntoView({ behavior: "smooth", block: "start" });
    }

    function setAlert(message, type = "error") {
      const banner = document.getElementById("alert-banner");
      const text = document.getElementById("alert-text");
      if (!banner || !text) return;
      text.textContent = message;
      if (type === "error") {
        banner.style.background = "rgba(239,68,68,0.1)";
        banner.style.borderColor = "rgba(248,113,113,0.7)";
      } else {
        banner.style.background = "rgba(22,163,74,0.1)";
        banner.style.borderColor = "rgba(34,197,94,0.7)";
      }
      banner.classList.add("show");
    }

    function hideAlert() {
      const banner = document.getElementById("alert-banner");
      if (banner) banner.classList.remove("show");
    }

    function updateStepUI(step) {
      currentStep = step;
      const stepLabel = document.getElementById("step-label");
      if (stepLabel) stepLabel.textContent = `STEP ${step} OF 3`;

      ["step-1","step-2","step-3"].forEach((id, index) => {
        const el = document.getElementById(id);
        if (!el) return;
        el.style.display = (index + 1 === step) ? "block" : "none";
      });

      [1,2,3].forEach(num => {
        const bar = document.getElementById(`step-bar-${num}`);
        if (!bar) return;
        if (num <= step) bar.classList.add("active");
        else bar.classList.remove("active");
      });
    }

    function goToStep(step) {
      hideAlert();
      if (step === 1) {
        updateStepUI(1);
        selectedSlot = null;
      } else if (step === 2) {
        if (!currentLeadId) {
          setAlert("Please complete Step 1 first.", "error");
          return;
        }
        updateStepUI(2);
      } else if (step === 3) {
        if (!currentLeadId || !selectedSlot) {
          setAlert("Please confirm your date & time first.", "error");
          return;
        }
        updateStepUI(3);
      }
    }

    function populateGrades() {
      const gradeSelect = document.getElementById("child-grade");
      if (!gradeSelect) return;
      const options = [];
      for (let i = 1; i <= 12; i++) {
        const opt = document.createElement("option");
        opt.value = `Grade ${
          i
        }`;
        opt.textContent = `Grade ${ i }`;
        options.push(opt);
      }
      options.forEach(o => gradeSelect.appendChild(o));
    }

    function setupLaptopToggle() {
      const group = document.getElementById("laptop-toggle");
      if (!group) return;
      const buttons = Array.from(group.querySelectorAll(".toggle-pill"));
      buttons.forEach(btn => {
        btn.addEventListener("click", () => {
          buttons.forEach(b => b.classList.remove("active"));
          btn.classList.add("active");
        });
      });
    }

    function getLaptopValue() {
      const group = document.getElementById("laptop-toggle");
      if (!group) return null;
      const active = group.querySelector(".toggle-pill.active");
      return active ? active.getAttribute("data-value") : null;
    }

    function initPhoneInput() {
      const input = document.getElementById("phone-input");
      if (!input) return;

      itiInstance = window.intlTelInput(input, {
        initialCountry: "auto",
        preferredCountries: ["us","gb","ae","sa","in","ca","au","nz","sg","qa","kw","bh","om"],
        geoIpLookup: function(callback) {
          fetch("https://ipapi.co/json/")
            .then(function(res) { return res.json(); })
            .then(function(data) { callback((data && data.country_code) ? data.country_code.toLowerCase() : "ae"); })
            .catch(function() { callback("ae"); });
        },
        utilsScript: "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/18.2.1/js/utils.js"
      });
    }

    function parseUrlParams() {
      const params = new URLSearchParams(window.location.search);
      const courseIdRaw = params.get("courseId");
      const langParam = params.get("lang");
      currentCourseId = courseIdRaw ? parseInt(courseIdRaw, 10) || null : null;
      landingLang = langParam ? String(langParam).toLowerCase() : null;
    }

    function buildLanguagePills() {
      const container = document.getElementById("language-pills");
      if (!container) return;
      container.innerHTML = "";
      LANGUAGES.forEach(lang => {
        const label = lang.charAt(0).toUpperCase() + lang.slice(1);
        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = "language-pill";
        btn.textContent = label;
        btn.dataset.value = lang;
        btn.addEventListener("click", () => {
          Array.from(container.querySelectorAll(".language-pill")).forEach(b => b.classList.remove("active"));
          btn.classList.add("active");
          selectedLanguage = lang;
        });
        container.appendChild(btn);
      });
    }

    function setupChips(groupId, onChange) {
      const container = document.getElementById(groupId);
      if (!container) return;
      const chips = Array.from(container.querySelectorAll(".choice-chip"));
      chips.forEach(chip => {
        chip.addEventListener("click", () => {
          chips.forEach(c => c.classList.remove("active"));
          chip.classList.add("active");
          if (onChange) onChange(chip.getAttribute("data-value"));
        });
      });
    }

    function setupStep1Form() {
      const form = document.getElementById("step-1-form");
      const submitBtn = document.getElementById("step-1-submit");
      const phoneError = document.getElementById("phone-error");
      const childNameInput = document.getElementById("child-name");
      const gradeSelect = document.getElementById("child-grade");
      const parentNameInput = document.getElementById("parent-name");
      const parentEmailInput = document.getElementById("parent-email");

      if (!form || !submitBtn) return;

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        hideAlert();
        if (phoneError) phoneError.style.display = "none";

        if (!itiInstance) {
          setAlert("Phone selector failed to load. Please refresh and try again.");
          return;
        }

        const phoneNumber = (document.getElementById("phone-input").value || "").trim();
        const numberValid = itiInstance.isValidNumber();
        const countryData = itiInstance.getSelectedCountryData();

        if (!phoneNumber || !numberValid || !countryData) {
          if (phoneError) {
            phoneError.textContent = "Please enter a valid WhatsApp number with country code.";
            phoneError.style.display = "block";
          }
          return;
        }

        const childName = (childNameInput.value || "").trim();
        const childGrade = gradeSelect.value || "";
        const parentName = (parentNameInput.value || "").trim();
        const parentEmail = (parentEmailInput.value || "").trim();
        const hasLaptop = getLaptopValue();

        if (!childName || !childGrade || !parentName || !parentEmail) {
          setAlert("Please fill all the fields to continue.", "error");
          return;
        }

        submitBtn.disabled = true;
        submitBtn.textContent = "Saving details...";

        const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone || null;
        const browser = navigator.userAgent || null;
        const iso2 = (countryData.iso2 || "").toUpperCase();
        const regionKey = ISO2_TO_REGION[iso2] || null;
        currentRegionKey = regionKey;

        const payload = {
          child_name: childName,
          child_grade: childGrade,
          parent_name: parentName,
          parent_email: parentEmail,
          phone_country_code: "+" + countryData.dialCode,
          phone_number: phoneNumber,
          is_whatsapp: true,
          has_laptop: hasLaptop,
          course_id: currentCourseId,
          lang: landingLang || "english",
          landing_page_path: window.location.pathname,
          full_url: window.location.href,
          timezone,
          browser,
          country: countryData.name || null,
          region_key: regionKey,
          page_completed: 1
        };

        try {
          const { data, error } = await supabaseClient
            .from("demo_leads")
            .insert([payload])
            .select()
            .single();

          if (error || !data) {
            console.error("Insert error", error);
            setAlert("Unable to save your details. Please try again in a moment.", "error");
          } else {
            currentLeadId = data.id;
            goToStep(2);
            await loadSlotsForRegion();
          }
        } catch (err) {
          console.error(err);
          setAlert("Something went wrong while saving your details. Please try again.", "error");
        } finally {
          submitBtn.disabled = false;
          submitBtn.textContent = "Book a Free Trial Class";
        }
      });
    }

    async function loadSlotsForRegion() {
      const dateGrid = document.getElementById("date-grid");
      const timeGrid = document.getElementById("time-grid");
      const dateRangeLabel = document.getElementById("date-range-label");
      const step2Error = document.getElementById("step-2-error");
      if (!dateGrid || !timeGrid) return;

      dateGrid.innerHTML = "";
      timeGrid.innerHTML = "";
      if (step2Error) step2Error.style.display = "none";

      if (!currentRegionKey || !currentCourseId) {
        if (step2Error) {
          step2Error.textContent = "We couldn‚Äôt detect your region. Please refresh and try again.";
          step2Error.style.display = "block";
        }
        return;
      }

      const now = new Date();
      const todayStr = now.toISOString().slice(0,10);
      const maxDate = new Date(now.getTime());
      maxDate.setDate(maxDate.getDate() + 5);
      const maxStr = maxDate.toISOString().slice(0,10);

      if (dateRangeLabel) {
        const opts = { month: "short", day: "numeric" };
        dateRangeLabel.textContent = `${ now.toLocaleDateString(undefined, opts) } ‚Äì ${ maxDate.toLocaleDateString(undefined, opts) }`;
      }

      try {
        const { data: slots, error } = await supabaseClient
          .from("demo_slots_live")
          .select("*")
          .eq("region_key", currentRegionKey)
          .eq("course_id", currentCourseId)
          .eq("is_active", true)
          .gt("capacity_remaining", 0)
          .gte("slot_date", todayStr)
          .lte("slot_date", maxStr)
          .order("slot_datetime_ist", { ascending: true });

        if (error) {
          console.error("Slots error", error);
          if (step2Error) {
            step2Error.textContent = "Unable to load live slots. Please refresh and try again.";
            step2Error.style.display = "block";
          }
          return;
        }

        if (!slots || !slots.length) {
          dateGrid.innerHTML = '<div class="centered-message">No live slots are available for the next few days in your region. Please check again later.</div>';
          return;
        }

        const byDate = new Map();
        slots.forEach(slot => {
          const dateKey = slot.slot_date;
          if (!byDate.has(dateKey)) byDate.set(dateKey, []);
          byDate.get(dateKey).push(slot);
        });

        const sortedDates = Array.from(byDate.keys()).sort();

        let firstDateKey = null;

        sortedDates.forEach((dateKey, index) => {
          const dateObj = new Date(dateKey);
          const isToday = dateKey === todayStr;
          const diffDays = Math.round((dateObj - new Date(todayStr)) / (1000*60*60*24));
          let dayLabel = dateObj.toLocaleDateString(undefined, { weekday: "long" });
          if (diffDays === 0) dayLabel = "Today";
          else if (diffDays === 1) dayLabel = "Tomorrow";

          const dateLabel = dateObj.toLocaleDateString(undefined, { day: "2-digit", month: "short" });

          const chip = document.createElement("button");
          chip.type = "button";
          chip.className = "date-chip";
          chip.dataset.dateKey = dateKey;
          chip.innerHTML = `<span class="day-label">${ dayLabel }</span><span class="date-label">${ dateLabel }</span>`;

          chip.addEventListener("click", () => {
            Array.from(dateGrid.querySelectorAll(".date-chip")).forEach(c => c.classList.remove("active"));
            chip.classList.add("active");
            renderTimeChips(dateKey, byDate.get(dateKey) || []);
          });

          if (index === 0) {
            firstDateKey = dateKey;
          }

          dateGrid.appendChild(chip);
        });

        if (firstDateKey) {
          const firstChip = dateGrid.querySelector(`.date-chip[data-date-key="${firstDateKey}"]`);
          if (firstChip) firstChip.classList.add("active");
          renderTimeChips(firstDateKey, byDate.get(firstDateKey) || []);
        }

      } catch (err) {
        console.error(err);
        if (step2Error) {
          step2Error.textContent = "Unable to load live slots. Please refresh and try again.";
          step2Error.style.display = "block";
        }
      }
    }

    function renderTimeChips(dateKey, slotsForDay) {
      const timeGrid = document.getElementById("time-grid");
      if (!timeGrid) return;
      timeGrid.innerHTML = "";
      selectedSlot = null;

      if (!slotsForDay || !slotsForDay.length) {
        timeGrid.innerHTML = '<div class="centered-message">No slots are available on this day. Please try another date.</div>';
        return;
      }

      slotsForDay.forEach(slot => {
        const istDate = new Date(slot.slot_datetime_ist);
        const timeLabel = istDate.toLocaleTimeString([], { hour: "numeric", minute: "2-digit" });

        const chip = document.createElement("button");
        chip.type = "button";
        chip.className = "time-chip";
        chip.dataset.slotId = slot.id;

        const starHtml = slot.is_star_teacher
          ? '<span class="star-tag"><span class="icon">‚≠ê</span><span>Star teacher</span></span>'
          : "";

        chip.innerHTML = `
          <div class="time-chip-header">
            <span class="time-main-label">${ timeLabel }</span>
            ${ starHtml }
          </div>
          <div class="slot-subtext">1:1 live class ¬∑ 60 mins</div>
        `;

        chip.addEventListener("click", () => {
          Array.from(timeGrid.querySelectorAll(".time-chip")).forEach(c => c.classList.remove("active"));
          chip.classList.add("active");
          selectedSlot = Object.assign({ }, slot, { local_time_label: timeLabel });
        });

        timeGrid.appendChild(chip);
      });
    }

    function setupStep2Submit() {
      const btn = document.getElementById("step-2-submit");
      const errorEl = document.getElementById("step-2-error");
      if (!btn) return;

      btn.addEventListener("click", async () => {
        hideAlert();
        if (errorEl) errorEl.style.display = "none";

        if (!currentLeadId) {
          if (errorEl) {
            errorEl.textContent = "Please complete Step 1 first.";
            errorEl.style.display = "block";
          }
          return;
        }

        if (!selectedSlot) {
          if (errorEl) {
            errorEl.textContent = "Please select a date and time for your class.";
            errorEl.style.display = "block";
          }
          return;
        }

        if (!selectedLanguage) {
          if (errorEl) {
            errorEl.textContent = "Please select your preferred language.";
            errorEl.style.display = "block";
          }
          return;
        }

        btn.disabled = true;
        btn.textContent = "Confirming...";

        try {
          const updates = {
            preferred_date: selectedSlot.slot_date,
            preferred_time_slot: selectedSlot.local_time_label,
            slot_id: selectedSlot.id,
            lang: selectedLanguage,
            page_completed: 2
          };

          const { error } = await supabaseClient
            .from("demo_leads")
            .update(updates)
            .eq("id", currentLeadId);

          if (error) {
            console.error("Update step 2 error", error);
            if (errorEl) {
              errorEl.textContent = "Unable to confirm slot right now. Please try another time or date.";
              errorEl.style.display = "block";
            }
          } else {
            goToStep(3);
          }
        } catch (err) {
          console.error(err);
          if (errorEl) {
            errorEl.textContent = "Something went wrong. Please try again.";
            errorEl.style.display = "block";
          }
        } finally {
          btn.disabled = false;
          btn.textContent = "Confirm Class Time";
        }
      });
    }

    function setupStep3Submit() {
      const btn = document.getElementById("step-3-submit");
      const successEl = document.getElementById("step-3-success");
      if (!btn || !successEl) return;

      let whoValue = null;
      let whyValue = null;
      let whenValue = null;

      setupChips("chip-who", (val) => { whoValue = val; });
      setupChips("chip-why", (val) => { whyValue = val; });
      setupChips("chip-when", (val) => { whenValue = val; });

      btn.addEventListener("click", async () => {
        hideAlert();
        successEl.style.display = "none";

        if (!currentLeadId) {
          setAlert("Please start again from Step 1.", "error");
          return;
        }

        if (!whoValue || !whyValue || !whenValue) {
          setAlert("Please answer all the questions so we can personalise your experience.", "error");
          return;
        }

        btn.disabled = true;
        btn.textContent = "Submitting...";

        try {
          const updates = {
            who_are_you: whoValue,
            booking_reason: whyValue,
            purchase_timeline: whenValue,
            page_completed: 3
          };

          const { error } = await supabaseClient
            .from("demo_leads")
            .update(updates)
            .eq("id", currentLeadId);

          if (error) {
            console.error("Update step 3 error", error);
            setAlert("Unable to save your responses right now. Please try again.", "error");
          } else {
            successEl.style.display = "block";
          }
        } catch (err) {
          console.error(err);
          setAlert("Something went wrong. Please try again.", "error");
        } finally {
          btn.disabled = false;
          btn.textContent = "Submit";
        }
      });
    }

    document.addEventListener("DOMContentLoaded", () => {
      parseUrlParams();
      populateGrades();
      setupLaptopToggle();
      initPhoneInput();
      setupStep1Form();
      buildLanguagePills();
      setupStep2Submit();
      setupStep3Submit();
      updateStepUI(1);
    });
  </script>
</body>
</html>
